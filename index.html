<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Markdownベースのリッチテキスト編集とフローチャート可視化を統合したPWAアプリケーション">
    <meta name="theme-color" content="#0d9488">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="iEditWeb">
    <link rel="apple-touch-icon" href="icon/icon.png">
    <title>iEditWeb</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/editor.css">
    <link rel="stylesheet" href="styles/flowchart.css">
    <link rel="stylesheet" href="styles/search.css">
    <link rel="stylesheet" href="styles/settings.css">
    <link rel="stylesheet" href="styles/color-picker.css">
    <script>
        /**
         * Service Worker登録
         * 要件 12.1: PWAとしてインストール可能
         * 要件 12.2: オフラインキャッシュ機能
         */
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then((registration) => {
                        console.log('Service Worker登録成功:', registration.scope);

                        // 更新があった場合の処理
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('新しいService Workerが見つかりました');

                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('新しいコンテンツが利用可能です。ページを更新してください。');
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('Service Worker登録失敗:', error);
                    });
            });
        }
    </script>
    <!-- Tiptap import map for offline bundle -->
    <script type="importmap">
        {
            "imports": {
                "tiptap": "./assets/vendor/tiptap.bundle.js"
            }
        }
    </script>
    <script src="assets/lib/jszip.min.js"></script>
    <script src="assets/lib/FileSaver.min.js"></script>
</head>

<body>

    <!-- Header -->
    <header id="toolbar">
        <div id="toggleSidebar" title="アウトライン表示/非表示">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z" />
            </svg>
        </div>
        <div id="filename">無題のドキュメント</div>
        <div class="header-controls">
            <button id="searchBtn" title="検索 (Ctrl+F)">
                <svg class="icon" viewBox="0 0 24 24">
                    <path
                        d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
                </svg>
            </button>
            <button id="settingsBtn" title="設定">
                <svg class="icon" viewBox="0 0 24 24">
                    <path
                        d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.35 19.43,11.03L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11.03C4.53,11.35 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.04 4.95,18.95L7.44,17.95C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.95L19.05,18.95C19.27,19.04 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" />
                </svg>
            </button>
            <button id="saveBtn" title="保存 (Ctrl+S)">
                <svg class="icon" viewBox="0 0 24 24">
                    <path
                        d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z" />
                </svg>
            </button>
            <button id="loadBtn" title="読み込み">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                </svg>
            </button>
        </div>
    </header>

    <div id="container">
        <!-- Sidebar -->
        <aside id="sidebar">
            <div id="resizer"></div>
            <div class="sidebar-section">
                <h3>アウトライン</h3>
                <div id="outline-list"></div>
            </div>
        </aside>

        <!-- Outline Icon Picker -->
        <div id="outline-icon-picker" class="hidden"></div>

        <!-- Main Content -->
        <main id="main-content">
            <!-- Flowchart Area -->
            <div id="flowchart-container">
                <div class="flowchart-toolbar">
                    <button class="mode-btn active" data-mode="select" title="選択">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M7,2V11H9V13H7V22H17V13H15V11H17V2H7M9,4H15V9H9V4M9,15H15V20H9V15Z" />
                        </svg>
                    </button>
                    <button class="mode-btn" data-mode="connect" title="接続">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M10.59,13.41C11,13.8 11,14.44 10.59,14.83C10.2,15.22 9.56,15.22 9.17,14.83C7.22,12.88 7.22,9.71 9.17,7.76V7.76L12.71,4.22C14.66,2.27 17.83,2.27 19.78,4.22C21.73,6.17 21.73,9.34 19.78,11.29L18.29,12.78C18.3,11.96 18.17,11.14 17.89,10.36L18.36,9.88C19.54,8.71 19.54,6.81 18.36,5.64C17.19,4.46 15.29,4.46 14.12,5.64L10.59,9.17C9.41,10.34 9.41,12.24 10.59,13.41M13.41,9.17C13.8,8.78 14.44,8.78 14.83,9.17C16.78,11.12 16.78,14.29 14.83,16.24V16.24L11.29,19.78C9.34,21.73 6.17,21.73 4.22,19.78C2.27,17.83 2.27,14.66 4.22,12.71L5.71,11.22C5.7,12.04 5.83,12.86 6.11,13.64L5.64,14.12C4.46,15.29 4.46,17.19 5.64,18.36C6.81,19.54 8.71,19.54 9.88,18.36L13.41,14.83C14.59,13.66 14.59,11.76 13.41,10.59C13,10.2 13,9.56 13.41,9.17Z" />
                        </svg>
                    </button>

                    <div class="toolbar-separator"></div>
                    <button id="zoom-in-btn" class="mode-btn" title="拡大">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z" />
                        </svg>
                    </button>
                    <button id="zoom-out-btn" class="mode-btn" title="縮小">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14M7,9H12V10H7V9Z" />
                        </svg>
                    </button>
                    <button id="fit-view-btn" class="mode-btn" title="全体表示">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M2,2H8V4H4V8H2V2M22,8V2H16V4H20V8H22M2,16V22H8V20H4V16H2M20,20H16V22H22V16H20V20M9,7V9H7V15H9V17H15V15H17V9H15V7H9M9,9H15V15H9V9Z" />
                        </svg>
                    </button>
                </div>

                <div id="flowchart-canvas">
                    <div id="canvas-content">
                        <svg id="connections-layer">
                            <defs>
                                <marker id="arrow-head" markerWidth="10" markerHeight="10" refX="10" refY="5"
                                    orient="auto">
                                    <path d="M0,0 L10,5 L0,10" fill="#94a3b8" />
                                </marker>
                                <marker id="arrow-head-selected" markerWidth="10" markerHeight="10" refX="10" refY="5"
                                    orient="auto">
                                    <path d="M0,0 L10,5 L0,10" fill="#3b82f6" />
                                </marker>
                                <marker id="arrow-tail" markerWidth="10" markerHeight="10" refX="0" refY="5"
                                    orient="auto">
                                    <path d="M10,0 L0,5 L10,10" fill="#94a3b8" />
                                </marker>
                                <marker id="arrow-tail-selected" markerWidth="10" markerHeight="10" refX="0" refY="5"
                                    orient="auto">
                                    <path d="M10,0 L0,5 L10,10" fill="#3b82f6" />
                                </marker>
                            </defs>
                        </svg>
                        <div id="shapes-layer"></div>
                    </div>
                </div>
            </div>

            <div id="vertical-resizer"></div>

            <!-- Editor Area Wrapper (エディタとコメントサイドバー) -->
            <div id="editor-area">

                <!-- Flowchart Toggle Button -->
                <button id="flowchart-toggle-btn" class="flowchart-toggle-btn" title="折りたたみ">
                    <svg class="icon" viewBox="0 -960 960 960">
                        <path
                            d="m296-224-56-56 240-240 240 240-56 56-184-183-184 183Zm0-240-56-56 240-240 240 240-56 56-184-183-184 183Z" />
                    </svg>
                </button>

                <div id="editor-container">
                    <div id="editor" contenteditable="true" spellcheck="false">
                        <h1>ここにタイトルを入力...</h1>
                        <p>本文をここに入力してください。</p>
                    </div>
                    <!-- Comment Sidebar (常に表示モード用) -->
                    <aside id="comment-sidebar" class="hidden">
                        <div id="comment-list"></div>
                    </aside>
                </div>
            </div>
        </main>
    </div>

    <!-- Floating Toolbar -->
    <div id="float-toolbar" class="hidden">
        <button data-cmd="bold" title="太字"><svg class="icon" viewBox="0 0 24 24">
                <path
                    d="M13.5,15.5H10V12.5H13.5A1.5,1.5 0 0,1 15,14A1.5,1.5 0 0,1 13.5,15.5M10,6.5H13A1.5,1.5 0 0,1 14.5,8A1.5,1.5 0 0,1 13,9.5H10M15.6,10.79C16.57,10.11 17.25,9.02 17.25,8C17.25,5.74 15.5,4 13.25,4H7V18H14.04C16.14,18 17.75,16.3 17.75,14.21C17.75,12.69 16.89,11.39 15.6,10.79Z" />
            </svg></button>
        <button data-cmd="italic" title="斜体"><svg class="icon" viewBox="0 0 24 24">
                <path d="M10,4V7H12.21L8.79,15H6V18H14V15H11.79L15.21,7H18V4H10Z" />
            </svg></button>
        <button data-cmd="underline" title="下線"><svg class="icon" viewBox="0 0 24 24">
                <path
                    d="M5,21H19V19H5V21M12,17A6,6 0 0,0 18,11V3H15.5V11A3.5,3.5 0 0,1 12,14.5A3.5,3.5 0 0,1 8.5,11V3H6V11A6,6 0 0,0 12,17Z" />
            </svg></button>
        <div class="separator"></div>
        <button data-cmd="insertUnorderedList" title="箇条書き"><svg class="icon" viewBox="0 0 24 24">
                <path
                    d="M7,5H21V7H7V5M7,13V11H21V13H7M4,4.5A1.5,1.5 0 0,1 5.5,6A1.5,1.5 0 0,1 4,7.5A1.5,1.5 0 0,1 2.5,6A1.5,1.5 0 0,1 4,4.5M4,10.5A1.5,1.5 0 0,1 5.5,12A1.5,1.5 0 0,1 4,13.5A1.5,1.5 0 0,1 2.5,12A1.5,1.5 0 0,1 4,10.5M7,19V17H21V19H7M4,16.5A1.5,1.5 0 0,1 5.5,18A1.5,1.5 0 0,1 4,19.5A1.5,1.5 0 0,1 2.5,18A1.5,1.5 0 0,1 4,16.5Z" />
            </svg></button>
        <button data-cmd="insertOrderedList" title="番号付きリスト"><svg class="icon" viewBox="0 0 24 24">
                <path
                    d="M7,13V11H21V13H7M7,19V17H21V19H7M7,7V5H21V7H7M3,8V5H2V4H4V8H3M2,17V16H5V20H2V19H4V18.5H3V17.5H4V17H2M4.25,10A0.75,0.75 0 0,1 5,10.75C5,10.95 4.92,11.14 4.79,11.27L3.12,13H5V14H2V13.08L4,11H2V10H4.25Z" />
            </svg></button>
        <div class="separator"></div>
        <select id="formatBlockSelect">
            <option value="p">テキスト</option>
            <option value="h1">見出し 1</option>
            <option value="h2">見出し 2</option>
            <option value="h3">見出し 3</option>
            <option value="h4">見出し 4</option>
            <option value="blockquote">引用</option>
        </select>
        <div class="separator"></div>
        <button id="textColorBtn" title="文字色">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M9.62,12L12,5.67L14.37,12M11,3L5.5,17H7.75L8.87,14H15.12L16.25,17H18.5L13,3H11Z" />
            </svg>
        </button>
        <button id="highlightBtn" title="背景色">
            <svg class="icon" viewBox="0 0 24 24">
                <path
                    d="M18.5,1.15C17.97,1.15 17.46,1.34 17.07,1.73L11.26,7.55L16.91,13.2L22.73,7.39C23.5,6.61 23.5,5.35 22.73,4.56L19.89,1.73C19.5,1.34 19,1.15 18.5,1.15M10.3,8.5L4.34,14.46C3.56,15.24 3.56,16.5 4.36,17.31C3.14,18.54 1.9,19.77 0.67,21H6.33L7.19,20.14C7.97,20.9 9.22,20.89 10,20.12L15.95,14.16" />
            </svg>
        </button>
        <div class="separator"></div>
        <button id="rubyBtn" title="ルビ">
            <span style="font-weight: bold; font-size: 12px;">ルビ</span>
        </button>
        <button id="codeBtn" title="コード">
            <svg class="icon" viewBox="0 0 24 24">
                <path
                    d="M14.6,16.6L19.2,12L14.6,7.4L16,6L22,12L16,18L14.6,16.6M9.4,16.6L4.8,12L9.4,7.4L8,6L2,12L8,18L9.4,16.6Z" />
            </svg>
        </button>
        <div class="separator"></div>
        <button id="linkBtn" title="リンク">
            <svg class="icon" viewBox="0 0 24 24">
                <path
                    d="M10.59,13.41C11,13.8 11,14.44 10.59,14.83C10.2,15.22 9.56,15.22 9.17,14.83C7.22,12.88 7.22,9.71 9.17,7.76V7.76L12.71,4.22C14.66,2.27 17.83,2.27 19.78,4.22C21.73,6.17 21.73,9.34 19.78,11.29L18.29,12.78C18.3,11.96 18.17,11.14 17.89,10.36L18.36,9.88C19.54,8.71 19.54,6.81 18.36,5.64C17.19,4.46 15.29,4.46 14.12,5.64L10.59,9.17C9.41,10.34 9.41,12.24 10.59,13.41M13.41,9.17C13.8,8.78 14.44,8.78 14.83,9.17C16.78,11.12 16.78,14.29 14.83,16.24V16.24L11.29,19.78C9.34,21.73 6.17,21.73 4.22,19.78C2.27,17.83 2.27,14.66 4.22,12.71L5.71,11.22C5.7,12.04 5.83,12.86 6.11,13.64L5.64,14.12C4.46,15.29 4.46,17.19 5.64,18.36C6.81,19.54 8.71,19.54 9.88,18.36L13.41,14.83C14.59,13.66 14.59,11.76 13.41,10.59C13,10.2 13,9.56 13.41,9.17Z" />
            </svg>
        </button>
        <button id="commentBtn" title="コメント">
            <svg class="icon" viewBox="0 -960 960 960">
                <path
                    d="M240-400h480v-80H240v80Zm0-120h480v-80H240v80Zm0-120h480v-80H240v80ZM880-80 720-240H160q-33 0-56.5-23.5T80-320v-480q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v720ZM160-320h594l46 45v-525H160v480Zm0 0v-480 480Z" />
            </svg>
        </button>
    </div>

    <!-- Ruby Panel (ルビパネル) -->
    <div id="ruby-panel" class="ruby-panel hidden">
        <div class="ruby-panel-content">
            <input type="text" id="ruby-input" placeholder="ルビを入力..." />
            <div class="ruby-panel-buttons">
                <button id="ruby-apply-btn" class="ruby-btn primary">適用</button>
                <button id="ruby-delete-btn" class="ruby-btn danger">削除</button>
            </div>
        </div>
    </div>

    <!-- Comment Panel (コメントパネル) -->
    <div id="comment-panel" class="comment-panel hidden">
        <div class="comment-panel-content">
            <textarea id="comment-input" placeholder="コメントを入力..." rows="3"></textarea>
            <div class="comment-panel-buttons">
                <button id="comment-apply-btn" class="comment-btn primary">適用</button>
                <button id="comment-delete-btn" class="comment-btn danger">削除</button>
            </div>
        </div>
    </div>

    <!-- Comment Popup (マウスオーバー時のポップアップ) -->
    <div id="comment-popup" class="comment-popup hidden">
        <div class="comment-popup-content">
            <div class="comment-popup-text"></div>
            <button class="comment-popup-edit-btn" title="編集">
                <svg viewBox="0 -960 960 960" width="16" height="16">
                    <path
                        d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Link Panel (リンクパネル) -->
    <div id="link-panel" class="link-panel hidden">
        <div class="link-panel-content">
            <div class="link-panel-field">
                <label for="link-input">リンク先</label>
                <input type="text" id="link-input" placeholder="URLまたは見出しを入力..." />
            </div>
            <div id="link-heading-list" class="link-heading-list hidden"></div>
            <div class="link-panel-field">
                <label for="link-title-input">表示テキスト</label>
                <input type="text" id="link-title-input" placeholder="表示テキスト（任意）..." />
            </div>
            <div class="link-panel-buttons">
                <button id="link-apply-btn" class="link-btn primary">適用</button>
                <button id="link-delete-btn" class="link-btn danger">削除</button>
            </div>
        </div>
    </div>

    <!-- Link Popup (リンクマウスオーバー時のポップアップ) -->
    <div id="link-popup" class="link-popup hidden">
        <div class="link-popup-content">
            <span class="link-popup-text"></span>
            <button class="link-popup-edit-btn" title="編集">
                <svg viewBox="0 -960 960 960" width="16" height="16">
                    <path
                        d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Image Toolbar (画像用ツールバー) -->
    <div id="image-toolbar" class="hidden">
        <button id="align-left-btn" title="左揃え">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M3,3H21V5H3V3M3,7H15V9H3V7M3,11H21V13H3V11M3,15H15V17H3V15M3,19H21V21H3V19Z" />
            </svg>
        </button>
        <button id="align-center-btn" title="中央揃え">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M3,3H21V5H3V3M7,7H17V9H7V7M3,11H21V13H3V11M7,15H17V17H7V15M3,19H21V21H3V19Z" />
            </svg>
        </button>
        <button id="align-right-btn" title="右揃え">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M3,3H21V5H3V3M9,7H21V9H9V7M3,11H21V13H3V11M9,15H21V17H9V15M3,19H21V21H3V19Z" />
            </svg>
        </button>
        <div class="separator"></div>
        <button id="float-toggle-btn" title="段組み切替">
            <svg class="icon" viewBox="0 0 24 24">
                <path
                    d="M3,5H11V7H3V5M13,5H21V7H13V5M3,9H11V11H3V9M13,9H21V11H13V9M3,13H11V15H3V13M13,13H21V15H13V13M3,17H11V19H3V17M13,17H21V19H13V19Z" />
            </svg>
        </button>
        <div class="separator"></div>
        <button id="delete-image-btn" class="delete-btn" title="削除">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
            </svg>
        </button>
    </div>

    <!-- Color Picker -->
    <div id="textColorPicker" class="color-picker hidden"></div>
    <div id="highlightPicker" class="color-picker hidden"></div>

    <!-- Search Panel -->
    <div id="search-panel" class="hidden">
        <div class="search-row">
            <input type="text" id="search-input" placeholder="検索...">
            <button id="do-search-btn" title="検索">検索</button>
            <button id="find-prev-btn" title="前へ">↑</button>
            <button id="find-next-btn" title="次へ">↓</button>
            <button id="close-search-btn" title="閉じる">×</button>
        </div>
        <div class="search-row">
            <input type="text" id="replace-input" placeholder="置換...">
            <button id="replace-btn">置換</button>
            <button id="replace-all-btn">すべて置換</button>
        </div>
        <div class="search-options">
            <label class="search-option">
                <input type="checkbox" id="regex-mode-checkbox">
                <span>正規表現</span>
            </label>
            <label class="search-option">
                <input type="checkbox" id="case-sensitive-checkbox">
                <span>大文字/小文字を区別</span>
            </label>
        </div>
        <div class="search-info" id="search-info"></div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden">
        <div class="settings-content">
            <div class="settings-header">
                <h2>設定</h2>
                <button id="close-settings-btn" class="close-btn">×</button>
            </div>
            <div class="settings-body">
                <div class="setting-item">
                    <label>テーマ</label>
                    <select id="theme-select">
                        <option value="light">ライト</option>
                        <option value="dark">ダーク</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label>プライマリーカラー</label>
                    <input type="color" id="primary-color-picker" value="#0d9488">
                </div>
                <div class="setting-item">
                    <label>フォント</label>
                    <select id="font-select">
                        <option value="sans-serif">ゴシック体 (Sans-serif)</option>
                        <option value="serif">明朝体 (Serif)</option>
                        <option value="monospace">等幅 (Monospace)</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label>フォントサイズ (px)</label>
                    <input type="number" id="font-size-input" value="16" min="10" max="32">
                </div>
                <div class="setting-item">
                    <label>エディタ背景色</label>
                    <input type="color" id="editor-bg-color" value="#ffffff">
                </div>
                <div class="setting-item">
                    <label>文字色</label>
                    <input type="color" id="editor-text-color" value="#334155">
                </div>
                <div class="setting-item">
                    <label>背景画像</label>
                    <div class="background-image-settings">
                        <div id="bg-image-preview" class="bg-preview hidden"></div>
                        <div class="bg-controls">
                            <label for="bg-image-input" class="file-upload-btn">ファイルを選択</label>
                            <input type="file" id="bg-image-input" accept="image/png, image/jpeg, image/gif, image/webp"
                                class="hidden">
                            <button id="delete-bg-image-btn" class="danger-btn hidden">画像を削除</button>
                        </div>
                    </div>
                </div>
                <div class="setting-item">
                    <label>コメント表示</label>
                    <select id="comment-display-select">
                        <option value="always">常に表示</option>
                        <option value="hover">マウスオーバー時のみ</option>
                    </select>
                </div>
                <div class="settings-footer">
                    <button id="save-settings-btn" class="primary-btn">保存して適用</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Flowchart Context Menu -->
    <div id="flowchart-context-menu" class="context-menu hidden">
        <!-- シェイプ用の編集フォーム -->
        <div id="shape-edit-section" class="context-menu-section">
            <div class="context-menu-title">ノード スタイル</div>
            <div class="context-menu-form">
                <div class="context-menu-row">
                    <label>背景色</label>
                    <div id="ctx-shape-bg" class="color-swatch" tabindex="0"></div>
                </div>
                <div class="context-menu-row">
                    <label>枠線色</label>
                    <div id="ctx-shape-border" class="color-swatch" tabindex="0"></div>
                </div>
                <div class="context-menu-row">
                    <label>文字色</label>
                    <div id="ctx-shape-text" class="color-swatch" tabindex="0"></div>
                </div>
            </div>
        </div>

        <!-- 接続線用の編集フォーム -->
        <div id="connection-edit-section" class="context-menu-section hidden">
            <div class="context-menu-title">線 スタイル</div>
            <div class="context-menu-form">
                <div class="context-menu-row">
                    <label>スタイル</label>
                    <select id="ctx-connection-style">
                        <option value="solid">実線</option>
                        <option value="dashed">点線</option>
                    </select>
                </div>
                <div class="context-menu-row">
                    <label>先端</label>
                    <select id="ctx-connection-arrow">
                        <option value="end">片側矢印</option>
                        <option value="none">矢印なし</option>
                        <option value="both">両側矢印</option>
                    </select>
                </div>
                <div class="context-menu-row">
                    <label>線色</label>
                    <div id="ctx-connection-color" class="color-swatch" tabindex="0"></div>
                </div>
                <div class="context-menu-row">
                    <label>ラベル</label>
                    <input type="text" id="ctx-connection-label" placeholder="テキスト入力">
                </div>
            </div>
        </div>

        <div class="context-menu-separator"></div>
        <div class="context-menu-item delete" data-action="delete">削除</div>
    </div>

    <div id="global-color-picker-container" style="position: absolute; display: none; z-index: 10000;"></div>

    <script type="module" src="src/main.js?v=2"></script>
</body>

</html>